# Миграция на TonMineFarm API

## Обзор изменений

Код был переделан с AgentX API на TonMineFarm API. Основные изменения:

### 1. Изменение API эндпоинтов
- **Старый**: `https://api.agentx.pw/`
- **Новый**: `https://api.tonminefarm.com/request`

### 2. Изменение логики авторизации
- Убрана система refresh токенов
- Используется только `tgWebAppData` для авторизации
- Изменен формат запросов на POST с JSON данными

### 3. Изменение логики работы с майнерами
- **Старая логика**: Отслеживание энергии узлов (x-basic, x-pro)
- **Новая логика**: Отслеживание времени работы майнеров

### 4. Новые параметры майнеров
- `unlim`: 0 - ограниченный майнер, 1 - бесконечный
- `working_time`: время работы в формате "HH:MM:SS" или "DD:HH:MM:SS"

## Логика работы

### Авторизация
```python
request_data = {
    "t": "home",
    "a": "get2", 
    "ref": 0,
    "pool_id": 0,
    "initData": tg_web_data,
    "fp": ""
}
```

### Получение статуса
Используется тот же запрос, что и для авторизации.

### Запуск майнера
```python
request_data = {
    "t": "home",
    "a": "start_miner",
    "asic_id": asic_id,
    "asic_level": asic_level,
    "initData": tg_web_data,
    "fp": "0ead51051b4bf434740bdd0193bfb530"
}
```

## Алгоритм работы

1. **Проверка майнеров**: Получаем список всех майнеров
2. **Фильтрация**: Пропускаем майнеры с `unlim: 1` (бесконечные)
3. **Анализ времени**: Проверяем `working_time` для каждого майнера
4. **Запуск**: Если время >= 4 часов, запускаем майнер с задержкой 1-5 минут
5. **Ожидание**: Засыпаем на минимальное время до следующей проверки

## Форматы времени

- `""` - пустое время, майнер не работает
- `"03:57:11"` - 3 часа 57 минут 11 секунд
- `"05:10:42:54"` - 5 дней 10 часов 42 минуты 54 секунды

## Важные поля

- `fp`: Для запроса статуса - пустая строка, для запуска майнера - `"0ead51051b4bf434740bdd0193bfb530"`
- `working_time`: Время работы майнера, пустое если майнер не работает
- `unlim`: 0 - ограниченный майнер, 1 - бесконечный (пропускается)
- `working`: 0 - майнер не работает, 1 - работает

## Классы

- `BaseBot` - базовый класс с общей логикой
- `TonMineFarmBot` - специализированный класс для TonMineFarm

## Заголовки

Используются заголовки из `get_tonminefarm_headers()` в `bot/core/headers.py`

## Имя бота

Используется `"TonFarmOfficial_bot"` (то же самое, что и раньше)
